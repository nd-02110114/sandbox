# 作って学ぶ RDBMS の仕組み

## メモ

### 1 章

- RDBMS のアーキテクチャ
  - 構文解析
  - クエリプランナ：実行計画の最適化・決定
    - アクセスメソッドの呼び出し順とかを決める
    - SQL の`Explain` で一部をみることができる
  - クエリエクスキュータ：アクセスメソッドの呼び出し
  - アクセスメソッド：ディスク上のデータ構造をたどる
    - 見に行くだけ、読み書きはしない (探索みたいなイメージ...?)
  - バッファプールマネージャー：データの塊をメモリにキャッシュ
    - アクセスメソッドの要求に応じて、ディスクのデータの貸し出し
    - 直接的な読み書きもここではしない
  - ディスクマネージャ：データの塊をディスクに書く・読む
    - データの読み書き
- セカンダリインデックス
  - いったん放置

### 2 章

- ヒープファイル
  - ファイルを固定の長さ(バイト数)で区切ったもの
  - 区切った単位は「ページ」と呼ばれる、本では 4096 バイト
  - 必ずページ単位で読み書きする
    - 読みたい内容が 100 バイトでも 4096 バイト全てをとってくる
    - これは実際に HDD/SSD に内容を書き込む時にそうなっているから
    - ファイルマネージャーの仕様
- ディスクマネージャ
  - データをページごとに読んだり、書いたりする
  - 実装も比較的そのまま、わかりやすい
- Rust 関連
  - AsRef：参照から参照への変換を担うトレイト
    - https://doc.rust-lang.org/std/convert/trait.AsRef.html
    - example をみる限り、面倒な型変換を無くしてくれそう
  - `#[derive(...)]`
    - 継承、特定のトレイトの標準的な実装を提供する
  - `#[repr(C)]`
    - メモリレイアウトの最適化をしない設定
  - `impl Trait`
    - Generics っぽく書いた方がわかりやすい
    - トレイトを実装した構造体を受け取るということ
    - https://doc.rust-jp.rs/book-ja/ch10-02-traits.html
      - 引数としてのトレイトのところに書いてあった
  - Seek : ファイルのカーソルを指定の位置へ移動させる
    - https://doc.rust-lang.org/stable/std/io/trait.Seek.html

### 3 章

- バッファプールマネージャー
  - I/O 操作は遅いから、メモリにデータをキャッシュする
  - ファイルシステムも独自でキャッシュ機能を持っているが、RDBMS も直接キャッシュ管理する
    - DB 操作に最適化されたキャッシュ機能をもつ
- Rust 関連
  - `Rc<T>`
    - `T`を使っているすべてのものが使い終わるまで、`T`には生存しててほしいタイミングなどに使える
    - 基本的に、Rust では値一つに対して所有者が一つで、不便なことも多い
  - `Default`
    - いい感じに初期値を入れてくれるやつ

### ４章

- B+Tree の概要の把握
  - 平衡 n 分木に分類されるデータ構造
  - 検索・挿入・削除に関する操作が全て O(logN) でバランスが良い
